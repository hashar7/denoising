# Сравнительный анализ методов устранения инструментального шума в данных спутникового термического зондирования: от классических фильтров к архитектурам NAFNet

**Аннотация**
В работе рассматривается задача устранения шума (denoising) на спутниковых изображениях, полученных с канала 53–80 температурного зондировщика (данные МТВЗА-ГЯ). Специфика данных характеризуется наличием инструментального шума и отсутствием эталонного «чистого» изображения (Ground Truth). Исследуются три класса методов: базовый медианный фильтр, алгоритм BM3D с адаптивной оценкой шума и глубокие нейронные сети (DnCNN, TinyNAFNet, NAFNet), обученные в режиме самообучения (Self-Supervised) непосредственно на зашумленных данных. Оценка качества производится с использованием безэталонных метрик (NRR, ENL, EPI). Результаты демонстрируют, что архитектура NAFNet обеспечивает наилучший баланс между подавлением шума и сохранением границ облачных структур.

---

## 1. Введение

Данные дистанционного зондирования Земли (ДЗЗ), получаемые с микроволновых радиометров, часто подвержены инструментальным шумам, возникающим из-за нестабильности калибровки датчиков или внешних помех. В рассматриваемом канале 53–80 (температурное зондирование) шум проявляется как в виде высокочастотных флуктуаций, так и в виде полосных артефактов.

Классические методы фильтрации часто приводят к размытию границ физических объектов (облаков, фронтов). Современные подходы на основе глубокого обучения требуют больших объемов парных данных «шум-чистое», которые отсутствуют для реальных спутниковых наблюдений. В данной работе предлагается подход, основанный на самообучении (finetuning) нейросетевых моделей на одиночном изображении с использованием маскирования, и проводится сравнение с алгоритмом BM3D.

## 2. Данные и методология

### 2.1. Подготовка данных
В качестве исходных данных используются файлы формата HDF (переменная `m_m2413_53_80V`). Данные представляют собой двумерные массивы яркостных температур.
Перед обработкой выполняется предварительная нормализация данных. Для нейросетевых методов применяется стандартизация (Z-score normalization) на основе глобального среднего и стандартного отклонения изображения. Для метода BM3D данные приводятся к диапазону [0, 1].

### 2.2. Классические методы

**Медианная фильтрация (Baseline)**
В качестве базового решения (baseline) используется медианный фильтр с окном $5 \times 5$. Данный метод эффективен против импульсного шума, но склонен к размытию текстур.

**BM3D (Block-Matching and 3D Filtering)**
Алгоритм BM3D [1] осуществляет группировку схожих 2D-фрагментов изображения в 3D-массивы с последующей фильтрацией в области трансформации (например, вейвлет или DCT).
В реализации использована автоматическая робастная оценка стандартного отклонения шума ($\sigma$) с помощью свертки с лапласианом вида:
$$ H = \begin{bmatrix} 1 & -2 & 1 \\ -2 & 4 & -2 \\ 1 & -2 & 1 \end{bmatrix} $$
Оценка $\sigma$ производится через медианное абсолютное отклонение (MAD): $\sigma_{est} = \text{median}(|I * H|) / 0.6745$. Это позволяет адаптировать параметры фильтра под конкретный снимок без ручного подбора.

### 2.3. Нейросетевые архитектуры

Реализован конвейер (pipeline) глубокого обучения, включающий три архитектуры. Поскольку «чистые» данные отсутствуют, обучение проводилось в режиме **Self-Supervised Finetuning** непосредственно на тестовом изображении.
Стратегия обучения:
1.  Извлечение случайных патчей размером $128 \times 128$.
2.  Применение случайного маскирования пикселей (Mask Ratio = 0.05).
3.  Минимизация $L_1$-функции потерь только на замаскированных пикселях (аналог подхода Noise2Void/MAE).

**1. DnCNN (Denoising Convolutional Neural Network)**
Использована модифицированная архитектура DnCNN [2]. Сеть состоит из 12 слоев. Первый слой: Conv+ReLU. Скрытые слои: Conv+BatchNorm+ReLU. Выходной слой: Conv. Используется концепция остаточного обучения (Residual Learning): сеть предсказывает не чистое изображение, а шумовую компоненту, которая затем вычитается из входного сигнала.
*Параметры реализации:* 64 карты признаков, ядро $3 \times 3$.

**2. TinyNAFNet**
Облегченная версия архитектуры без нелинейных функций активации (Nonlinear Activation Free). Блок состоит из свертки $1 \times 1$, глубинной свертки $3 \times 3$, GELU и финальной свертки $1 \times 1$. Используется упрощенный механизм внимания через обучаемый параметр $\beta$.

**3. NAFNet (Full Architecture)**
Полноценная архитектура NAFNet [3], показывающая State-of-the-Art результаты в задачах восстановления изображений. Модель построена по принципу U-Net с энкодером и декодером (глубины блоков [2, 2, 4], 8 срединных блоков).
Ключевой элемент — блок **NAFBlockV2**, который заменяет традиционные функции активации (ReLU/GELU) на механизм шлюзования (SimpleGate):
$$ \text{SimpleGate}(X, Y) = X \odot Y $$
где входной тензор делится на две части по каналам.
В реализации также применены:
*   LayerNorm (реализован как GroupNorm с 1 группой) для стабилизации обучения.
*   Канальное внимание (Simplified Channel Attention) заменено на простые сверточные ветви в FFN для снижения вычислительной сложности при сохранении качества.

### 2.4. Инференс (Применение моделей)
Для устранения артефактов на границах патчей при обработке полноразмерного спутникового снимка применен метод скользящего окна с перекрытием (stride = 64 при размере патча 128) и взвешиванием окном Ханна (Hanning window). Это обеспечивает гладкость сшивки результирующего изображения.

## 3. Метрики оценки качества

В условиях отсутствия эталона использовались следующие безэталонные метрики:

1.  **Noise Reduction Rate (NRR):** $1 - \frac{\sigma^2_{residual}}{\sigma^2_{original}}$. Оценивает степень подавления дисперсии сигнала. Идеальный диапазон 0.4–0.85 (слишком высокие значения указывают на потерю сигнала).
2.  **Equivalent Number of Looks (ENL):** Отношение квадрата среднего к дисперсии. Относительный прирост ENL показывает улучшение радиометрического разрешения.
3.  **Edge Preservation Index (EPI):** Корреляция градиентов (оператор Собеля) исходного и отфильтрованного изображений. Значения близкие к 1.0 указывают на хорошее сохранение границ.
4.  **HF Energy Ratio:** Отношение энергии высоких частот (разность с гауссовым размытием) после и до фильтрации.
5.  **Residual Structure SSIM:** Мера структурного подобия (SSIM) между остатком (шумом) и нулевым массивом. Низкие значения (близкие к 0) говорят о том, что удаленный шум не содержит структурных элементов изображения.

## 4. Результаты и обсуждение

Результаты работы методов представлены в Таблице 1.

**Таблица 1. Сводные метрики эффективности методов шумоподавления**

| Метод | NRR | ENL (orig/denoised) | ENL Increase | EPI | HF Energy Ratio | Residual SSIM |
|:---|:---:|:---:|:---:|:---:|:---:|:---:|
| **Initial Filtering** (существующий) | 0.1685 | 392 / 2589 | 5.60 | 0.0903 | 0.0002 | 0.4598 |
| **Median Filter** | 0.1750 | 392 / 2028 | 4.17 | 0.1143 | 0.0236 | 0.4674 |
| **BM3D** | 0.4810 | 392 / 830 | 1.12 | 0.8702 | 0.2500 | **0.0578** |
| **DnCNN** | **0.7293** | 392 / 584 | 0.49 | 0.7332 | **0.7084** | 0.8358 |
| **TinyNAFNet** | 0.5770 | 392 / 508 | 0.30 | 0.8492 | 0.4771 | 0.3583 |
| **NAFNet** | 0.5980 | 392 / 571 | 0.46 | **0.8959** | 0.4953 | 0.2717 |

### Анализ результатов:

1.  **BM3D:** Демонстрирует отличные показатели структурной корректности остатка (Residual SSIM = 0.0578). Это означает, что метод удаляет почти исключительно шум, не затрагивая полезный сигнал. Однако NRR (0.48) ниже, чем у нейросетевых методов, что говорит о меньшей агрессивности подавления.
2.  **DnCNN:** Показывает самое агрессивное шумоподавление (NRR = 0.7293). Однако высокий показатель Residual SSIM (0.8358) и низкий EPI (0.7332) свидетельствуют о том, что сеть удаляет вместе с шумом значительную часть полезных высокочастотных деталей и текстур (эффект "переглаживания").
3.  **NAFNet:** Является наиболее сбалансированным решением. Метод достиг наилучшего показателя сохранения границ (**EPI = 0.8959**), превзойдя даже BM3D. Значение NRR (0.598) указывает на эффективное подавление шума без чрезмерного сглаживания. Residual SSIM (0.27) значительно лучше, чем у DnCNN, что говорит о лучшей селективности алгоритма благодаря механизму SimpleGate и отсутствию "мертвых зон" функций активации ReLU.

## 5. Вывод

В ходе исследования был реализован и протестирован комплекс алгоритмов шумоподавления для данных спутникового зондирования.
Установлено, что классический метод **BM3D** с автоматической оценкой шума является наиболее безопасным с точки зрения сохранения физической структуры сигнала, минимизируя утечку полезной информации в шум.
Однако современная архитектура **NAFNet**, адаптированная через самообучение (self-supervised finetuning) с использованием маскирования, показала превосходство в сохранении резкости границ объектов (наивысший EPI), обеспечивая при этом более сильное подавление шума, чем BM3D.
Архитектура **DnCNN** в данной реализации показала склонность к избыточному сглаживанию (over-smoothing), что делает её менее пригодной для задач, где важны мелкие текстурные детали атмосферных образований.

Рекомендуемым методом для обработки данных канала 53–80 является **NAFNet** (или BM3D при жестких требованиях к сохранению энергии остатка), интегрированный с процедурой оконного инференса для устранения блочных артефактов.

---

### Список литературы

1.  Dabov, K., et al. "Image denoising by sparse 3-D transform-domain collaborative filtering." *IEEE Transactions on image processing* 16.8 (2007): 2080-2095.
2.  Zhang, K., et al. "Beyond a gaussian denoiser: Residual learning of deep cnn for image denoising." *IEEE transactions on image processing* 26.7 (2017): 3142-3155.
3.  Chen, L., et al. "Simple Baselines for Image Restoration." *European Conference on Computer Vision (ECCV)*. 2022.
